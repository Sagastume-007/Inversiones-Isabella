<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pedidos</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    :root { --menu-height: 52px; }
    * { box-sizing: border-box; }
    body { margin: 0; padding: 10px; background: #f4f6fb; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .top-spacer { display: block; width: 100%; height: var(--menu-height); }
    .top-header { display:flex; align-items:center; gap:8px; padding:8px 12px; background:#fff; border:1px solid #e0e0e0; border-radius:8px; }
    .top-header h1 { margin:0; color:#333; font-size:22px; flex:1; text-align:center; }
    .total-box { background:#fff; border:1px solid #3399ff; border-radius:6px; padding:4px 10px; font-weight:bold; color:#000; }
    .corr-box { background:#fff; border:1px solid #6c9dff; border-radius:6px; padding:4px 10px; font-weight:bold; color:#000; min-width:140px; text-align:center; }
    .metrics { display:flex; align-items:center; gap:8px; flex-wrap:nowrap; }
    .main { display:flex; flex-direction:column; gap:10px; margin-top:10px; }
    .left { flex:1; display:flex; flex-direction:column; gap:10px; }
    .client-box { background:#fff; border:1px solid #e0e0e0; border-radius:8px; padding:10px 12px; }
    .client-box h3 { margin:0 0 10px; color:#3399ff; font-size:16px; }
    .form-group { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .form-group label { width:90px; color:#555; }
    .form-group input { flex:1; padding:6px; border:1px solid #ddd; border-radius:4px; }
    .grid { background:#fff; border:1px solid #ccc; border-radius:6px; overflow:auto; }
    table { width:100%; border-collapse:collapse; font-size:11px; }
    thead { background:#f6f6f6; position:sticky; top:0; z-index:1; }
    th, td { border:1px solid #e0e0e0; padding:6px; }
    td input { width:100%; border:none; background:transparent; font-size:12px; outline:none; }
    
    /* Panel derecho - DESKTOP */
    .right { 
      width:110px; 
      display:flex; 
      flex-direction:column; 
      align-items:stretch; 
      gap:8px;
    }
    
    .action-btn { 
      background:transparent; 
      border:none; 
      border-radius:8px; 
      display:flex; 
      flex-direction:column; 
      gap:2px; 
      align-items:center; 
      justify-content:center; 
      cursor:pointer; 
      padding:4px;
      min-height: 50px;
    }
    .action-btn span { font-size: 11px; color: #333; text-align: center; line-height: 1.1; font-weight: 600; }
    .action-btn:hover { background: rgba(0,0,0,0.05); }
    .action-btn .icon { width:36px; height:36px; object-fit: contain; }
    .btn-icon img { width:14px !important; height:14px !important; }
    
    /* Modales */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; z-index: 10000000; }
    .modal { background: #ffffff; border: 1px solid #3399ff; border-radius: 10px; width: 700px; max-width: 95vw; box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
    .modal-header { padding: 12px 16px; border-bottom: 1px solid #e0f1ff; display: flex; align-items: center; justify-content: space-between; font-weight: bold; color: #1a252f; }
    .modal-body { padding: 16px; display: flex; gap: 16px; }
    .modal-row { display: flex; gap: 10px; align-items: center; }
    .modal-row label { width: 140px; color: #555; font-size: 14px; }
    .modal-row input, .modal-row select { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
    .modal-footer { padding: 12px 16px; border-top: 1px solid #e0f1ff; display: flex; gap: 10px; justify-content: flex-end; }
    .modal-left { width: 100%; display: flex; flex-direction: column; gap: 10px; }
    .btn { padding: 8px 14px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #3399ff; color: #fff; }
    .btn-secondary { background: #f0f6ff; color: #1a252f; border: 1px solid #b3e0ff; }
    .btn-icon { background: transparent; border: none; cursor: pointer; font-size: 1.2rem; padding: 0; margin: 0; }
    .btn-icon:hover { opacity: 0.7; }
    #tabla-pedido td.acciones { font-size: 0; display:flex; align-items:center; justify-content:center; gap:10px; }
    .codigo-input { position: relative; }
    .codigo-input .scan-btn { position: absolute; right: 4px; top: 50%; transform: translateY(-50%); }
    
    /* BARRA MÓVIL - Oculta por defecto en desktop */
    .mobile-actions { 
      display: none !important;
    }
    
    .mobile-actions-toggle { 
      display: none !important;
    }

    /* DESKTOP: > 1600px */
    @media (min-width: 1601px) {
      .main { flex-direction: row; }
      .right { 
        display: flex !important; 
        visibility: visible !important;
        position: static !important;
      }
      table { font-size: 14px; }
      th, td { padding: 9px; }
      td input { font-size: 14px; }
      .btn-icon img { width:20px !important; height:20px !important; }
      .action-btn .icon { width:36px; height:36px; }
    }

    /* MÓVIL: <= 1600px */
    @media (max-width: 1600px) {
      body { 
        padding: 10px 10px 70px 10px !important; 
        min-height: 100vh;
      }
      
      .top-header { flex-wrap:wrap; gap:8px; }
      .top-header h1 { font-size:18px; flex:1 0 100%; text-align:center; }
      .metrics { gap:6px; order: 1; width: 100%; display: flex; flex-wrap: nowrap; }
      .metrics .total-box, .metrics .corr-box { flex: 0 0 auto; min-width: 88px; padding: 3px 8px; font-size: 12px; }
      .total-box { text-align:center; }
      
      .main { 
        flex-direction:column; 
        min-height: calc(100vh - 100px);
        padding-bottom: 70px !important;
      }
      
      .grid { 
        margin-bottom: 70px !important; 
      }
      
      /* Ocultar panel derecho en móvil */
      .right { 
        display: none !important; 
      }
      
      /* MOSTRAR barra móvil */
      .mobile-actions { 
        position: fixed !important; 
        left: 0 !important; 
        right: 0 !important; 
        bottom: 0 !important;
        width: 100% !important; 
        height: 54px !important; 
        display: flex !important; 
        flex-direction: row !important;
        align-items: center !important; 
        justify-content: space-around !important; 
        background: #ffffff !important; 
        border-top: 2px solid #e0e0e0 !important; 
        padding: 4px !important; 
        box-sizing: border-box !important; 
        z-index: 999999 !important; 
        box-shadow: 0 -2px 10px rgba(0,0,0,0.15) !important; 
        visibility: visible !important;
        opacity: 1 !important;
        transform: translateY(0) !important;
      }
      
      .mobile-actions.collapsed {
        transform: translateY(100%) !important;
        opacity: 0 !important;
        pointer-events: none !important;
      }
      
      .mobile-actions.expanded {
        transform: translateY(0) !important;
        opacity: 1 !important;
        pointer-events: auto !important;
      }
      
      /* Botón toggle móvil */
      .mobile-actions-toggle { 
        position: fixed !important; 
        left: 50% !important; 
        transform: translateX(-50%) !important;
        bottom: 2px !important;
        z-index: 9999999 !important; 
        display: block !important;
        visibility: visible !important;
        background: #3399ff !important; 
        color: #fff !important;
        border: none !important;
        border-radius: 20px !important; 
        padding: 6px 20px !important; 
        font-size: 12px !important; 
        font-weight: 600 !important;
        line-height: 1.2 !important; 
        box-shadow: 0 2px 12px rgba(51,153,255,0.4) !important;
        cursor: pointer !important;
      }
      
      .mobile-actions-toggle:active {
        transform: translateX(-50%) scale(0.95) !important;
      }
      
      .action-btn { 
        height:48px !important; 
        flex:0 0 auto !important; 
        padding:4px !important; 
        flex-direction:column !important; 
        gap:2px !important; 
        min-width: 50px !important;
      }
      .action-btn .icon { width:24px !important; height:24px !important; }
      .action-btn span { display:block !important; font-size: 9px !important; }
      
      .overlay .modal { width: 95vw; height: 95vh; display: flex; flex-direction: column; }
      .modal-body { flex-direction: column; overflow: auto; }
      .btn-icon { padding: 0; margin: 0; }
      .btn-icon img { width:13px !important; height:13px !important; }
    }

    /* MÓVIL PEQUEÑO: <= 480px */
    @media (max-width: 480px) {
      .top-spacer { height: 48px; }
      body { padding: 6px 6px 70px 6px !important; }
      .top-header { gap:6px; }
      .metrics { gap:4px; }
      .metrics .total-box, .metrics .corr-box { font-size: 11px; padding: 3px 6px; min-width: 76px; }
      .form-group label { width: 80px; font-size: 12px; }
      .form-group input { font-size: 14px; }
      table { font-size: 10px; }
      thead th, tbody td { padding: 4px; }
      tr { line-height: 1.1; }
      
      /* Ocultar columnas en móvil pequeño */
      #tabla-pedido thead th:nth-child(6),
      #tabla-pedido tbody td:nth-child(6),
      #tabla-pedido thead th:nth-child(8),
      #tabla-pedido tbody td:nth-child(8) { display: none; }
      
      .mobile-actions { 
        height: 52px !important; 
      }
      
      .mobile-actions-toggle {
        bottom: 4px !important;
        padding: 5px 16px !important;
        font-size: 11px !important;
      }
      
      .action-btn { 
        height: 44px !important; 
        min-width: 45px !important;
      }
      .action-btn .icon { width:20px !important; height:20px !important; }
      .action-btn span { font-size: 8px !important; }
      
      .overlay .modal { 
        width: 98vw; 
        height: auto; 
        max-height: 90vh;
      }
      
      .modal-footer {
        flex-wrap: wrap;
        justify-content: center;
        gap: 6px;
        padding: 8px;
      }
      
      .modal-footer .btn {
        flex: 1 1 45%;
        font-size: 12px;
        padding: 8px;
      }
      
      .btn-icon img { width:12px !important; height:12px !important; }
    }
  </style>
</head>
<body>
  <div class="top-spacer"></div>
  <div class="top-header">
    <h1>Pedidos</h1>
    <div class="metrics">
      <div class="total-box">Total pedido: <span id="header-total">L 0.00</span></div>
      <div class="corr-box"><span id="header-corr">—</span></div>
      <div class="corr-box">Estado: <span id="header-estado">—</span></div>
    </div>
  </div>
  
  <div class="main">
    <div class="left">
      <div class="client-box">
        <h3>Información de Cliente</h3>
        <div class="form-group">
          <label>RTN No:</label>
          <input id="rtn-input" list="rtn-list" placeholder="Buscar RTN...">
          <datalist id="rtn-list"></datalist>
        </div>
        <div class="form-group">
          <label>Cliente:</label>
          <input id="cliente-input" placeholder="Nombre del cliente" list="cliente-list">
          <datalist id="cliente-list"></datalist>
        </div>
      </div>
      
      <div class="grid">
        <table id="tabla-pedido">
          <thead>
            <tr>
              <th style="width:30px; text-align:center;">No.</th>
              <th style="width:100px;">Código</th>
              <th>Descripción</th>
              <th style="width:60px; text-align:center;">Cant.</th>
              <th style="width:80px; text-align:right;">Precio</th>
              <th style="width:60px; text-align:center;">Stock</th>
              <th style="width:90px; text-align:right;">Total</th>
              <th style="width:60px; text-align:center;">ISV</th>
              <th style="width:130px; text-align:center;">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    
    <!-- Panel derecho - SOLO DESKTOP -->
    <div class="right">
      <button class="action-btn" onclick="abrirPedidosOverlay()" title="Pedidos">
        <img src="/iconos/pedidos.png" class="icon" alt="Pedidos">
        <span>Pedidos</span>
      </button>
      <button class="action-btn" onclick="redirFacturarVentas()" title="Facturar">
        <img src="/static/iconos/ventas.svg" class="icon" alt="Facturar">
        <span>Facturar</span>
      </button>
      <button class="action-btn" onclick="guardarPedido()" title="Guardar">
        <img src="/iconos/guardar.png" class="icon" alt="Guardar">
        <span>Guardar</span>
      </button>
      <button class="action-btn" onclick="limpiarTabla()" title="Eliminar">
        <img src="/iconos/eliminar.png" class="icon" alt="Eliminar">
        <span>Eliminar</span>
      </button>
      <button class="action-btn" onclick="limpiarTodo()" title="Limpiar">
        <img src="/iconos/limpiar.png" class="icon" alt="Limpiar">
        <span>Limpiar</span>
      </button>
      <button class="action-btn" onclick="guardarCambiosPedido()" title="Guardar cambios">
        <img src="/iconos/actualizar.png" class="icon" alt="Actualizar">
        <span>Actualizar</span>
      </button>
    </div>
  </div>

  <!-- Barra móvil inferior - SOLO MÓVIL -->
  <div class="mobile-actions collapsed">
    <button class="action-btn" onclick="abrirPedidosOverlay()" title="Pedidos">
      <img src="/iconos/pedidos.png" class="icon" alt="Pedidos">
      <span>Pedidos</span>
    </button>
    <button class="action-btn" onclick="redirFacturarVentas()" title="Facturar">
      <img src="/static/iconos/ventas.svg" class="icon" alt="Facturar">
      <span>Facturar</span>
    </button>
    <button class="action-btn" onclick="guardarPedido()" title="Guardar">
      <img src="/iconos/guardar.png" class="icon" alt="Guardar">
      <span>Guardar</span>
    </button>
    <button class="action-btn" onclick="limpiarTabla()" title="Eliminar">
      <img src="/iconos/eliminar.png" class="icon" alt="Eliminar">
      <span>Eliminar</span>
    </button>
    <button class="action-btn" onclick="limpiarTodo()" title="Limpiar">
      <img src="/iconos/limpiar.png" class="icon" alt="Limpiar">
      <span>Limpiar</span>
    </button>
    <button class="action-btn" onclick="guardarCambiosPedido()" title="Actualizar">
      <img src="/iconos/actualizar.png" class="icon" alt="Actualizar">
      <span>Actualizar</span>
    </button>
  </div>

  <!-- Botón toggle menú móvil -->
  <button class="mobile-actions-toggle" onclick="toggleMobileActions()">Menú</button>

  <!-- Modal Pedidos -->
  <div class="overlay" id="pedidos-overlay" tabindex="-1">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <span>Pedidos</span>
        <button class="btn btn-secondary" onclick="cerrarPedidosOverlay()">✖</button>
      </div>
      <div class="modal-body">
        <div class="modal-left">
          <div class="modal-row" style="width:100%;">
            <label>Estado</label>
            <select id="pedidos-filter" onchange="refrescarPedidosPendientes()">
              <option value="pendiente" selected>Pendientes</option>
              <option value="">Todos</option>
              <option value="generado">Generados</option>
            </select>
          </div>
          <div class="modal-row" style="width:100%;">
            <label>Buscar</label>
            <input type="text" id="pedidos-search" placeholder="Número, cliente o RTN" oninput="buscarPedidosPendientes()">
          </div>
          <div style="max-height:60vh; overflow:auto; border:1px solid #e0f1ff; border-radius:6px;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr>
                  <th style="padding:6px; border-bottom:1px solid #e0f1ff;">Número</th>
                  <th style="padding:6px; border-bottom:1px solid #e0f1ff;">Cliente</th>
                  <th style="padding:6px; border-bottom:1px solid #e0f1ff; text-align:right;">Total</th>
                  <th style="padding:6px; border-bottom:1px solid #e0f1ff;">Fecha</th>
                </tr>
              </thead>
              <tbody id="pedidos-list-body"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="refrescarPedidosPendientes()">Refrescar</button>
        <button class="btn btn-secondary" onclick="reactivarPedidoOverlay()">
          <img src="/iconos/activar.png" alt="+" style="width:16px;height:16px; vertical-align:middle; margin-right:6px;">Reactivar
        </button>
        <button class="btn btn-secondary" onclick="desactivarPedidoOverlay()">
          <img src="/iconos/desactivar.png" alt="-" style="width:16px;height:16px; vertical-align:middle; margin-right:6px;">Desactivar
        </button>
        <button class="btn btn-primary" onclick="cargarPedidoSeleccionadoOverlay()">Cargar</button>
      </div>
    </div>
  </div>

  <!-- Modal Scanner -->
  <div class="overlay" id="scanner-modal" tabindex="-1" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <span>Escanear código</span>
        <button class="btn btn-secondary" onclick="stopScanner()">✖</button>
      </div>
      <div class="modal-body">
        <div id="reader" style="width:100%; max-width:380px; margin:0 auto;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="stopScanner()">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    // [Tu JavaScript original aquí - lo mantuve igual, solo agregué las funciones de toggle]
    
    let html5QrcodeScanner = null;
    let scannerInputTarget = null;
    let mobileMenuTimer = null;
    const tbody = document.querySelector("#tabla-pedido tbody");
    
    // ... [resto de tu JavaScript]
    
    function toggleMobileActions() {
      const bar = document.querySelector(".mobile-actions");
      const toggle = document.querySelector(".mobile-actions-toggle");
      
      if (!bar || !toggle) return;
      
      if (bar.classList.contains("collapsed")) {
        // Expandir
        bar.classList.remove("collapsed");
        bar.classList.add("expanded");
        toggle.style.display = "none";
        
        // Auto-colapsar después de 60 segundos
        if (mobileMenuTimer) clearTimeout(mobileMenuTimer);
        mobileMenuTimer = setTimeout(() => {
          bar.classList.add("collapsed");
          bar.classList.remove("expanded");
          toggle.style.display = "block";
        }, 60000);
      } else {
        // Colapsar
        bar.classList.add("collapsed");
        bar.classList.remove("expanded");
        toggle.style.display = "block";
        
        if (mobileMenuTimer) clearTimeout(mobileMenuTimer);
      }
    }
    
    // Asegurar que la barra móvil esté presente
    function ensureMobileBar() {
      const isMobile = window.innerWidth <= 1600;
      const bar = document.querySelector(".mobile-actions");
      const toggle = document.querySelector(".mobile-actions-toggle");
      
      if (isMobile) {
        if (bar) {
          bar.style.display = "flex";
          bar.style.visibility = "visible";
        }
        if (toggle) {
          toggle.style.display = bar && bar.classList.contains("collapsed") ? "block" : "none";
          toggle.style.visibility = "visible";
        }
      }
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      if (tbody && tbody.rows.length === 0) agregarFila();
      ensureMobileBar();
    });
    
    window.addEventListener("load", () => {
      if (tbody && tbody.rows.length === 0) agregarFila();
      cargarClientes();
      actualizarCorrHeader();
      ensureMobileBar();
    });
    
    window.addEventListener("resize", ensureMobileBar);
    
    // [Resto de tus funciones JavaScript...]
  </script>
</body>
</html>